---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
------
```{r}
library(dplyr)
library(ggplot2)

```

```{r}
dat <- read.table("activity.csv",header=T,sep=",")
head(dat)
```


## What is mean total number of steps taken per day?
### 1. Calculate the total number of steps taken per day
```{r}
dt <- dat
steps_per_day <- aggregate(steps ~ date, data=dt, FUN=sum)
```


```{r}
head(steps_per_day)
```


## Make a histogram of the total number of steps taken each day
```{r}
hist(steps_per_day$steps, col="light blue",xlab = "Total steps daily", 
        main = "Number of steps per day")
```

### Calculate the mean and median of the total number of steps taken per day
```{r}
median(steps_per_day$steps,na.rm = TRUE)
mean(steps_per_day$steps,na.rm = TRUE)

```

## What is the average daily activity pattern?
### 1. Make a time series plot (i.e. type = “l”) of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)
```{r}
steps_i <- aggregate(steps ~ interval, data = dt, FUN = mean, na.rm = TRUE)
str(steps_i)
```

## timeseries graph
```{r}
plot(steps_i$interval,steps_i$steps,type="l",xlab="time",
        ylab="Average number of steps",main="Average daily activity pattern")
```

## 2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
```{r}
max_i <- steps_i[which.max(steps_i$steps),]
max_i
```


## Imputing missing values
### 1. Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)
```{r}
cout_missing_values <- sum(is.na(dt$steps))
cout_missing_values
```


### 2. Fill in all of the missing values in the dataset
```{r}
dn <- dt
i_na <- which(is.na(dn$steps))
for (i in i_na) {
  dn$steps[i] <- with(steps_i, steps[interval = dn$interval[i]])
}
```


### 3. Histogram of the total number of steps taken each day
```{r}
hist(dn$steps, col="light blue",xlab = "Total steps daily", 
         main = "Number of steps per day with imputed values")
```

         
### 4. Calculate and report the mean total number of steps taken per day
```{r}
mean(dn$steps,na.rm = TRUE)
```


### 5. Calculate and report the median total number of steps taken per day
```{r}
median(dn$steps,na.rm = TRUE)
```


## Are there differences in activity patterns between weekdays and weekends?
### 1. Create a new factor variable in the dataset with two levels - “weekday” and “weekend” indicating whether a given date is a weekday or weekend day.
```{r}
library(data.table)

d_table <- data.table(dn)
d_table[, weekday := ifelse(weekdays(date) %in% c("Saturday", "Sunday"), "Weekend", "Weekday")]
d_table$weekday <- as.factor(d_table$weekday)
d_table$interval <- as.integer(levels(d_table$interval)[d_table$interval])
head(d_table, 10)
```


### 2. Make a panel plot containing a time series plot (i.e. type = “l”) of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis)
```{r}
steps_w <- aggregate(steps ~ interval+weekday, data = d_table, FUN = mean)
plot(steps_w, aes(x = interval, y = steps)) + 
  geom_line(col = "blue", size = 1) + 
  facet_wrap(~ weekday, nrow=2, ncol=1) + 
  labs(x = "Interval", y = "Number of Steps")
  
 xyplot(steps ~ interval | day_type,
           data = d_table,
           type="l",
           xlab="Interval",ylab="Number of steps",main="Average weekday/weekend activity pattern",
           col.line = "blue",
           layout=c(1,2))
```











